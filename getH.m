clc;clear;close all;
%%¾ÉÍ¼×ø±ê
% imagePoints1 = [0370,1277;0818,1280;1270,1283;1718,1285;2169,1294;2606,1294;];
% imagePoints1 = [imagePoints1;0141,1497;0593,1499;1044,1506;1493,1512;1939,1514;2385,1518;2826,1522;];
% imagePoints1 = [imagePoints1;373,1724;819,1725;1265,1732;1714,1736;2156,1740;2596,1737];

% imagePoints1 = [0374,1098;0822,1104;1271,1106;1720,1111;2162,1115;2608,1119;];
% imagePoints1 = [imagePoints1;0147,1322;0592,1327;1043,1329;1491,1334;1939,1340;2383,1337;2826,1342;];
% imagePoints1 = [imagePoints1;0371,1549;0819,1552;1269,1552;1712,1558;2159,1559;2602,1566;];
% 
% imagePoints2 = [0411,799;0861,799;1311,799;1761,799;2211,799;2661,799];
% imagePoints2 = [imagePoints2;0186,1024;0636,1024;1086,1024;1536,1024;1986,1024;2436,1024;2886,1024];
% imagePoints2 = [imagePoints2;0411,1249;0861,1249;1311,1249;1761,1249;2211,1249;2661,1249];


% imagePoints1 = [373,1135;819,1139;1271,1143;1721,1151;2173,1151;2613,1157;];
% imagePoints1 = [imagePoints1;365,1583;817,1589;1267,1593;1715,1601;2165,1599;2611,1601];

% imagePoints1 = [379,959;819,963;1271,967;1721,971;2165,977;2619,979;];
% imagePoints1 = [imagePoints1;369,1405;815,1417;1269,1417;1717,1419;2162,1423;2612,1429;];

% imagePoints1 = [373,981;821,983;1271,991;1717,997;2164,1001;2604,1005;];
% imagePoints1 = [imagePoints1;369,1433;819,1437;1267,1443;1715,1443;2159,1445;2601,1449];

% imagePoints1 = [367,685;821,693;1269,697;1715,699;2163,703;2603,711;];
% imagePoints1 = [imagePoints1;371,1137;821,1139;1267,1143;1715,1147;2159,1151;2603,1157;];

%%ÐÂÍ¼
% imagePoints1 = [424,932;872,933;1324,934;1770,935;2215,936;2655,937;];
% imagePoints1 = [imagePoints1;875,1382;1322,1382;1769,1383;2214,1384;];
imagePoints1 = [424,933;872,933;1324,933;1770,933;2215,933;2655,933];
imagePoints1 = [imagePoints1;875,1383;1322,1383;1769,1383;2214,1383;];

imagePoints2 = [0411,933;0861,933;1311,933;1761,933;2211,933;2661,933];
imagePoints2 = [imagePoints2;0861,1383;1311,1383;1761,1383;2211,1383;];

% imagePoints2 = [imagePoints2;0411,1249;0861,1249;1311,1249;1761,1249;2211,1249;2661,1249];

A = [];
for i=1:10
A = [A;
    [0,0,0],                                    -1*[imagePoints1(i,1),imagePoints1(i,2),1],   imagePoints2(i,2)*[imagePoints1(i,1),imagePoints1(i,2),1];
     1*[imagePoints1(i,1),imagePoints1(i,2),1],  [0,0,0],                                     -imagePoints2(i,1)*[imagePoints1(i,1),imagePoints1(i,2),1];  
    ];
end
[u,s,v] = svd(A);

H = [v(1,9),v(2,9),v(3,9);
    v(4,9),v(5,9),v(6,9);
    v(7,9),v(8,9),v(9,9);
    ];
H = 1/H(3,3)*H

H = [0.9844,-0.0103,0;
    -0.0077,0.9693,0;
    0,0,1;]

imagePoints1 = H*[imagePoints1 ones(10,1)]';
% imagePoints1(1,:) = imagePoints1(1,:)-70;
% imagePoints1(2,:) = imagePoints1(2,:)-510;
imagePoints1 = imagePoints1';
% diff = mean(imagePoints1(1:6,2))-510
% 
% endrows = mean(imagePoints1(14:12,2))+diff
% 
% mean(imagePoints1(14:19,2))-mean(imagePoints1(1:6,2))
